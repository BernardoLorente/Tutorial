<?php
/**
 * The browse view file of task module of ZenTaoPMS.
 *
 * @copyright   Copyright 2009-2013 青岛易软天创网络科技有限公司 (QingDao Nature Easy Soft Network Technology Co,LTD www.cnezsoft.com)
 * @license     LGPL (http://www.gnu.org/licenses/lgpl.html)
 * @author      Chunsheng Wang <chunsheng@cnezsoft.com>
 * @package     task
 * @version     $Id: browse.html.php 4129 2013-01-18 01:58:14Z wwccss $
 * @link        http://www.zentao.net
 */
?>
<?php 
include '../../Task/view/header.html.php';
js::set('confirmDelete', $lang->task->confirmDelete);
?>

<form method='post' id='myTaskForm'>
  <table class='table w-1000px table-condensed table-hover table-striped tablesorter' align="center" id='tasktable'>
    <?php $vars = "viewtype=$viewtype&orderBy=%s&recTotal=$recTotal&recPerPage=$recPerPage&pageID=$pageID"; ?>
    <thead>
    <tr class='text-center'>
      <th width="10px" class='text-left'> <?php common::printOrderLink('id', $orderBy, $vars, $lang->idAB);?></th>
      <th class='w-150px text-left'><?php common::printOrderLink('title', $orderBy, $vars, $lang->task->title);?></th>
    <?php if ($this->session->userinfo->roleid != 'teacher'):?>
      <th class='w-40px'> <?php common::printOrderLink('asgID', $orderBy, $vars, $lang->task->creator);?></th>
    <?php endif;
      if ($this->session->userinfo->roleid != 'student'):
    ?>  
      <th class='w-40px'> <?php common::printOrderLink('acpID', $orderBy, $vars, $lang->task->receiver);?></th>
    <?php endif;?>  
      <th class='w-50px'> <?php common::printOrderLink('begintime', $orderBy, $vars, $lang->task->begin_time);?></th>
      <th class='w-50px'> <?php common::printOrderLink('deadline', $orderBy, $vars, $lang->task->deadline);?></th>
    <?php if ((($this->session->userinfo->roleid == 'student') && ($viewtype == 'undone')) || (($this->session->userinfo->roleid == 'teacher') && ($viewtype == 'assessed'))):?>
      <th class='w-50px'> <?php common::printOrderLink('assesstime', $orderBy, $vars, $lang->task->assess_time);?></th>
    <?php endif;
      if ($viewtype == 'done'):
    ?>
      <th class='w-50px'> <?php common::printOrderLink('completetime', $orderBy, $vars, $lang->task->complete_time);?></th>
    <?php endif;
      if (($this->session->userinfo->roleid == 'teacher') && (($viewtype == 'undone') || ($viewtype == 'unassessed'))):
    ?>
      <th class='w-50px'> <?php common::printOrderLink('readtime', $orderBy, $vars, $lang->task->readtime);?></th>
      <th class='w-50px'> <?php common::printOrderLink('submittime', $orderBy, $vars, $lang->task->submit_time);?></th>
    <?php endif;
      if ($viewtype == 'all'):
    ?>  
      <th class='w-30px'> <?php echo $lang->task->is_submitted;?></th>
      <th class='w-30px'> <?php echo $lang->task->is_assessed;?></th>
    <?php endif;
      if (($this->session->userinfo->roleid == 'teacher')||(($this->session->userinfo->roleid == 'student') && ($viewtype != 'done'))):?>
      <th class='w-30px'> <?php echo $lang->actions;?></th>
    <?php endif;?>
    </tr>
    </thead>
    <tbody>
      <?php foreach($tasks as $task):?>
      <tr class='text-center'>
        <td class='text-left'><?php echo $task->id;?></td>
        <td class='text-left nobr'><?php echo html::a($this->createLink('Task', 'view', "taskID=$task->id"), $task->title);?></td>
      <?php if ($this->session->userinfo->roleid != 'teacher'):?>
        <td><?php echo $userpairs[$task->asgID];?></td>
      <?php endif;
      if ($this->session->userinfo->roleid != 'student'):
      ?>
        <td><?php echo $userpairs[$task->acpID];?></td>
      <?php endif;?>    
        <td><?php echo $task->begintime;?></td>
        <td><?php echo $task->deadline;?></td>
      <?php if ((($this->session->userinfo->roleid == 'student') && ($viewtype == 'undone')) || (($this->session->userinfo->roleid == 'teacher') && ($viewtype == 'assessed'))):?>
        <td><?php echo $task->assesstime?></td>
      <?php endif;
        if ($viewtype == 'done'):
      ?>  
        <td><?php echo $task->completetime;?></td>
      <?php endif;
        if (($this->session->userinfo->roleid == 'teacher') && (($viewtype == 'undone') || ($viewtype == 'unassessed'))):
      ?>  
        <td><?php echo $task->readtime;?></td>
        <td><?php echo $task->submittime;?></td>
      <?php endif;
        if ($viewtype == 'all'):
      ?>  
        <td><?php echo $lang->task->submitList[($task->submittime != null)];?></td>
        <td><?php echo $lang->task->assessList[$task->is_assessed];?></td>
      <?php endif;
      if (($this->session->userinfo->roleid == 'teacher')||(($this->session->userinfo->roleid == 'student') && ($viewtype != 'done'))):?>
        <td class='text-center'>
          <?php
          if ($task->submittime == null)
          {
            common::printIcon('task', 'submit', "taskID=$task->id", '', 'list', 'ok-sign');          
          }
          
          common::printIcon('task', 'assess', "taskID=$task->id", '', 'list', 'edit'); 
          common::printIcon('task', 'edit', "taskID=$task->id", '', 'list', 'pencil');
          if(common::hasPriv('task', 'delete'))
          {
            echo common::printIcon('task', 'delete', "taskID=$task->id", $task, 'list', '', 'hiddenwin');          
          }
          ?>
        </td>
      <?php endif;?>
      </tr>
      <?php endforeach;?>
    </tbody>
    <tfoot>
      <tr>
        <?php $columns = $this->cookie->windowWidth > $this->config->wideSize ? 14 : 12;?>
        <td colspan='<?php echo $columns;?>'>
          <!-- <div class='table-actions clearfix'>
          <?php
          $canBatchClose = common::hasPriv('task', 'batchdelete');
          $canBatchEdit = common::hasPriv('task', 'batchedit');
          if(count($tasks))
          {
            echo "<div class='btn-group'>" . html::selectButton() . '</div>';

            $actionLink = $this->createLink('task', 'batchedit');
            $misc       = $canBatchEdit ? "onclick=\"setFormAction('$actionLink')\" formtarget=\"_blank\"" : "disabled='disabled'";

            echo "<div class='btn-group dropup'>";
            echo html::commonbutton($lang->edit, $misc, 'iframe');
            echo "<button id='moreAction' type='button' class='btn dropdown-toggle' data-toggle='dropdown'><span class='caret'></span></button>";
            echo "<ul class='dropdown-menu' id='moreActionMenu'>";
            $actionLink = $this->createLink('task', 'batchdelete');
            $misc = $canBatchClose ? "onclick=\"setFormAction('$actionLink','hiddenwin')\"" : "class='disabled'";
            echo "<li>" . html::a('#', $lang->delete, '', $misc) . "</li>";
            echo "</ul></div>";
          }
          //echo "<div class='text'>" . $summary . "</div>";
          ?>
          </div> -->
          <?php $pager->show();?>
        </td>
      </tr>
    </tfoot>
  </table> 
</form>
<?php include '../../common/view/footer.html.php';?>
