<?php
class statistics extends control
{
	private $roleid;
	
	/**
	 * Construct function, load model of project and story modules.
	 * 
	 * @access public
	 * @return void
	 */
	public function __construct()
	{
		parent::__construct();
		$roleid = $this->session->userinfo->roleid;
		
		$this->loadModel('resources');
		$this->loadModel('user');
		$this->loadModel('tutor');
		$this->loadModel('achievement');
        $this->loadModel('student');
	}


	/**
	 * Index page.
	 * @access public
	 * @return void
	 */
	public function index($viewtype = 'student', $orderBy = 'account_desc', $recTotal = 0, $recPerPage = 15, $pageID = 1)
	{
       /* Process the order by field. */
        if(!$orderBy) $orderBy = $this->cookie->StatisticsOrder ? $this->cookie->StatisticsOrder : 'account_desc';
        setcookie('StatisticsOrder', $orderBy, $this->config->cookieLife, $this->config->webRoot);

        /* Load pager and get tasks. */
        $this->app->loadClass('pager', $static = true);
        $pager = new pager($recTotal, $recPerPage, $pageID);

        $statistics = $this->statistics->getStatistics($viewtype,$orderBy,$pager);

        $this->view->statistics     = $statistics;
        $this->view->viewtype       = $viewtype;
        $this->view->pager          = $pager;
        $this->view->recTotal       = $pager->recTotal;
        $this->view->recPerPage     = $pager->recPerPage;
        $this->view->pageID         = $pager->pageID;
        $this->view->orderBy        = $orderBy;
		$this->display();
	}

	/**
	 * viewGraduationThesis page.
	 * @access public
	 * @return void
	 */
	public function viewGraduationThesis($account = 'all', $orderBy = 'id_desc', $recTotal = 0, $recPerPage = 100, $pageID = 1)
	{
		/* Load pager and get tasks. */
		$this->app->loadClass('pager', $static = true);
		$pager = new pager($recTotal, $recPerPage, $pageID);

		$userpairs = $this->user->getPairs('noletter');

		$results = $this->statistics->getThesises($account,$orderBy, $pager);
        $tutors_list = $results[0];
        $thesises = $results[1];

		/*set the summary*/
		$summary = sprintf($this->lang->achievement->thesis->summary, count($thesises));

		$this->view->position[] = $this->lang->statistics->index;
		$this->view->thesises = $thesises;
		$this->view->tutors_list = $tutors_list;
        $this->view->account = $account;
		$this->view->userpairs = $userpairs;
		$this->view->pager          = $pager;
		$this->view->recTotal    = $pager->recTotal;
		$this->view->recPerPage  = $pager->recPerPage;
        $this->view->pageID      = $pager->pageID;
		$this->view->orderBy     = $orderBy;
		$this->view->summary     = $summary;
		$this->display();
	}

	/**
	 * viewAchievement page.
	 * @access public
	 * @return void
	 */
	public function viewDetails($browsetype = 'task', $viewtype = 'student', $orderBy = 'account_desc', $recTotal = 0, $recPerPage = 100, $pageID = 1)
	{
		/* Process the order by field. */
        if(!$orderBy) $orderBy = $this->cookie->StatisticsOrder ? $this->cookie->StatisticsOrder : 'account_desc';
        setcookie('StatisticsOrder', $orderBy, $this->config->cookieLife, $this->config->webRoot);

        /* Load pager and get tasks. */
        $this->app->loadClass('pager', $static = true);
        $pager = new pager($recTotal, $recPerPage, $pageID);

        $details = $this->statistics->getDetails($browsetype,$viewtype,$orderBy,$pager);

        $this->view->details        = $details;
        $this->view->viewtype       = $viewtype;
        $this->view->browsetype     = $browsetype;
        $this->view->pager          = $pager;
        $this->view->recTotal       = $pager->recTotal;
        $this->view->recPerPage     = $pager->recPerPage;
        $this->view->pageID         = $pager->pageID;
        $this->view->orderBy        = $orderBy;

		$this->display();
	}

	/**
	 * viewAchievement page.
	 * @access public
	 * @return void
	 */
	public function viewOthers()
	{

		$this->view->title      = $this->lang->statistics->common;
		$this->view->position[] = $this->lang->statistics->index;
		$this->display();
	}

}
