<?php
class resourcesModel extends model
{
	/**
     * upload a file.
     * 
     * @access public
     * @return void
     */
    public function upload()
    {
        $file = '';

        $file_temp = fixer::input('post')
                        ->remove('files,labels')
                        ->get();

	    $file_title = $this->loadModel('file')->saveUpload('sharing', 0, $file_temp->extra, $file_temp->acl);
	    $file = $this->dao->select('*')->from(TABLE_FILE)->where('id')->eq(key($file_title))->fetch();
	    unset($file->id);
    }

    /**
     * get file by acl.
     * 
     * @access public
     * @return void
     */
    public function getFilesByACL($acl = '', $orderBy = '', $pager = null, 
        $paramtitle = '', $paramaddedBy = '')
    {
    	if(!$acl) $acl = array(3);
        if (!$orderBy) $orderBy = 'id_desc';

        $paramaddedByIDs = $this->loadModel('user')->getAccountByName($paramaddedBy);

		$files = $this->dao->select('*')->from(TABLE_FILE)
			->where('acl')->in($acl)
            ->andWhere('deleted')->eq(0)
            ->beginIF($paramtitle != '')->andWhere('title')->like('%' . $paramtitle . '%')->fi()
            ->andWhere('addedBy')->in($paramaddedByIDs)
            ->orderBy($orderBy)
            ->page($pager)
	    	->fetchAll();
	    if($files) return $files;
    }

    /**
     * check the user priv.
     * 
     * @access public
     * @return void
     */
    public function checkPriv($file, $user = 0)
    {
        if(!$user) $user = $this->session->user->account;
        if($file->addedBy == $user or $this->session->userinfo->roleid != 'student') return true;
        else
            return false;
    }
}