<?php
/**
 * The model file of report module of ZenTaoPMS.
 *
 * @copyright   Copyright 2009-2013 青岛易软天创网络科技有限公司 (QingDao Nature Easy Soft Network Technology Co,LTD www.cnezsoft.com)
 * @license     LGPL (http://www.gnu.org/licenses/lgpl.html)
 * @author      Chunsheng Wang <chunsheng@cnezsoft.com>
 * @package     report
 * @version     $Id: model.php 4726 2013-05-03 05:51:27Z chencongzhi520@gmail.com $
 * @link        http://www.zentao.net
 */
?>
<?php
class tutorModel extends model
{
	/**
     * 学生获取自己的导师
     */
    public function getTutorByStudent($user = '')
    {
        if(!$user) $user = $this->session->user->account;
        $teacher = $this->dao
                    ->select('t2.account, t2.realname')
                    ->from(TABLE_RELATIONS)->alias(t1)
                    ->leftJoin(TABLE_USER)->alias(t2)
                    ->on('t1.tea_ID=t2.account')
                    ->where('t1.stu_ID')->eq($user)
                    ->andWhere('t1.deleted')->eq(0)
                    ->fetchAll();
        return $teacher;
    }

    /**
     * 获取特定学院内的所有导师信息
     */
    public function getTutorByCollege($collegeID = '', $name = '', $account = '', $pager = null, $orderBy = '')
    {
        if (!$collegeID) $collegeID = $this->session->user->collegeid;
        if (!$orderBy) $orderBy = 'account';
        
        $tutors = $this->dao
                    ->select('account, realname, gender, department, title, college_id, department')
                    ->from(TABLE_USER)
                    ->where('deleted')->eq(0)
                    ->andWhere('status')->ne(-1)
                    ->andWhere('college_id')->eq($collegeID)
                    ->andWhere('role_id')->eq('teacher') 
                    ->andWhere('realname')->like('%' . $name . '%')
                    ->andWhere('account')->like('%' . $account . '%')                 
                    ->orderBy($orderBy)
                    ->page($pager)
                    ->fetchAll();

        return $tutors;
    }
}    
